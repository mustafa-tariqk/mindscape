<!-- FOR REFERENCE TO CONNECT API ENDPOINTS -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat Application</title>
</head>
<body>
    <div id="chat-container"></div>

    <div id="input-area">
        <input type="text" id="message-input" placeholder="Enter your message...">
        <button id="send-button">Send</button>
    </div>

    <script>
        let chatId; // Declare chatId as a global variable

        // Get the user ID from the API
        fetch('http://127.0.0.1:8080/') 
            .then(response => response.json())
            .then(data => {
                const userId = data.user_id;

                // Automatically start the chat
                startChat(userId);
                // print the user id
                console.log(userId);     
            });

        function startChat(userId) {
            fetch('http://127.0.0.1:8080/start_chat/' + userId)
                .then(response => response.json())
                .then(data => {
                    chatId = data.chat_id; // Update the global chatId variable
                    // Initialize chat interactions here
                });
        }

        // Event listener for sending messages
        document.getElementById('send-button').addEventListener('click', function() {
            const messageInput = document.getElementById('message-input');
            const message = messageInput.value;
            messageInput.value = ''; // Clear the input field 
            sendMessage(message); 
        });

        function sendMessage(message) {
            // Functionality to send a message to the '/converse' endpoint 
            // (You'll need to fetch the chat ID, which would be stored
            //  after the start_chat call)

            fetch('http://127.0.0.1:8080/converse/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    chat_id: chatId, // Make sure the chat_id is sent
                    message: message
                })
            })
            .then(response => response.json())
            .then(data => {
                displayMessage(data.ai_response, 'AI'); // Display AI response
            });
        }

        function displayMessage(message, sender) {
            const chatContainer = document.getElementById('chat-container');
            const messageElement = document.createElement('div');
            messageElement.classList.add('message');
            messageElement.classList.add(sender.toLowerCase()); // Add class for styling
            messageElement.textContent = message;
            chatContainer.appendChild(messageElement);

            // Scroll to the bottom of the chat container
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

    </script>
</body>
</html>