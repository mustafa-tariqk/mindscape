<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat Application</title>
</head>
<body>
    <button id="loginBtn">Login</button>
    <button id="logoutBtn" >Logout</button>
    <button id="userInfoBtn" >User Info</button>
    <button id="startChatBtn" >Start Chat</button>
    <div>
        <textarea id="messageBox" rows="4" cols="50"></textarea>
        <button id="converseBtn">Converse</button>
    </div>
    <div id="response"></div>

    <script>
        let user_id = null;
        let email = null;
        let chat_id = null;

        document.getElementById('loginBtn').addEventListener('click', () => {
            window.location.href = 'http://localhost:8080/login';
        });

        document.getElementById('logoutBtn').addEventListener('click', () => {
            window.location.href = 'http://localhost:8080/logout';
        });

        document.getElementById('userInfoBtn').addEventListener('click', () => {
            fetch('http://localhost:8080/api/user', {
                method: 'GET',
                mode: 'cors',
                credentials: 'include',
                headers: {
                    'Content-Type': 'application/json'
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    alert(`Error: ${data.error}`);
                } else {
                    user_id = data.user_id;
                    email = data.email;
                    alert(`User Email: ${email}, User ID: ${user_id}`);
                }
            });
        });

        document.getElementById('startChatBtn').addEventListener('click', () => {
            fetch('http://localhost:8080/api/start_chat/' + user_id, {
                method: 'GET',
                mode: 'cors',
                credentials: 'include',
                headers: {
                    'Content-Type': 'application/json'
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    alert(`Error: ${data.error}`);
                } else {
                    chat_id = data.chat_id;
                    alert(`Chat ID: ${chat_id}`);
                }
            });
        });

        document.getElementById('converseBtn').addEventListener('click', () => {
            const message = document.getElementById('messageBox').value;
            fetch('http://localhost:8080/api/converse', {
                method: 'POST',
                mode: 'cors',
                credentials: 'include',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ chat_id: chat_id, message: message })
            })
            .then(response => response.json())
            .then(data => {
                alert(`Response: ${data.ai_response}`);
            });
        });
    </script>
</body>
</html>
